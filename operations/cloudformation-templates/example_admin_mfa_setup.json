{
  "AWSTemplateFormatVersion":"2010-09-09",
  "Description":"Example of how to require MFA for an admin user",
  "Metadata":{
    "Source":"https://github.com/mozilla/security/tree/master/operations/cloudformation-templates"
  },
  "Parameters":{
    "TemporaryPassword":{
      "Description":"IAM User Temporary Password",
      "Type":"String",
      "NoEcho":true
    }
  },
  "Resources":{
    "User":{
      "Type":"AWS::IAM::User",
      "Properties":{
        "Path":"/",
        "LoginProfile":{
          "Password":{
            "Ref":"TemporaryPassword"
          },
          "PasswordResetRequired":true
        },
        "ManagedPolicyArns":[
          {
            "Ref":"ManagedPolicy"
          }
        ]
      }
    },
    "ManagedPolicy":{
      "Type":"AWS::IAM::ManagedPolicy",
      "Properties":{
        "Description":"AdministratorAccess with MFA",
        "PolicyDocument":{
          "Version":"2012-10-17",
          "Statement":[
            {
              "Effect":"Allow",
              "Action":"*",
              "Resource":"*",
              "Condition":{
                "Bool":{
                  "aws:MultiFactorAuthPresent":"true"
                }
              }
            }
          ]
        }
      }
    },
    "AccessKey":{
      "Type":"AWS::IAM::AccessKey",
      "Properties":{
        "Serial":1,
        "Status":"Active",
        "UserName":{
          "Ref":"User"
        }
      }
    }
  },
  "Outputs":{
    "UserName":{
      "Description":"The IAM User Name",
      "Value":{
        "Ref":"User"
      }
    },
    "AccessKeyId":{
      "Description":"The Access Key",
      "Value":{
        "Ref":"AccessKey"
      }
    },
    "SecretAccessKey":{
      "Description":"The Secret Access Key",
      "Value":{
        "Fn::GetAtt":[
          "AccessKey",
          "SecretAccessKey"
        ]
      }
    },
    "Instructions":{
      "Description":"Instructions on what to do next",
      "Value":"foo"
    }
  }
}
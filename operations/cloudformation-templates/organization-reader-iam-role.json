{
  "AWSTemplateFormatVersion":"2010-09-09",
  "Description":"IAM Role that grants Enterprise Information Security permission to read AWS Organization information",
  "Metadata":{
    "Source":"https://github.com/mozilla/security/tree/master/operations/cloudformation-templates"
  },
  "Mappings":{
    "VariablesMap":{
      "TrustedAccount":{
        "ExternalAccountId":"371522382791",
        "RoleName":"Infosec-Organization-Reader"
      }
    }
  },
  "Resources":{
    "IAMRole":{
      "Type":"AWS::IAM::Role",
      "Properties":{
        "RoleName": {"Fn::FindInMap":["VariablesMap","TrustedAccount","RoleName"]},
        "AssumeRolePolicyDocument":{
          "Version":"2012-10-17",
          "Statement":[
            {
              "Effect":"Allow",
              "Action":"sts:AssumeRole",
              "Principal":{
                "AWS":{"Fn::Join":[":",["arn:aws:iam:",{"Fn::FindInMap":["VariablesMap","TrustedAccount","ExternalAccountId"]},"root"]]}
              }
            }
          ]
        }
      }
    },
    "IAMPolicy":{
      "Type":"AWS::IAM::ManagedPolicy",
      "Properties":{
        "Description":"Policy granting AWS Organization read permissions",
        "PolicyDocument":{
          "Version":"2012-10-17",
          "Statement":[
            {
              "Effect":"Allow",
              "Action":[
                "organizations:Describe*",
                "organizations:List*"
              ],
              "Resource":"*"
            }
          ]
        },
        "Roles":[{
          "Ref":"IAMRole"
        }]
      }
    }
  },
  "Outputs":{
    "AssumeRoleArn":{
      "Value":{"Fn::GetAtt" : ["IAMRole", "Arn"] },
      "Description":"The ARN of the IAM Role"
    }
  }
}